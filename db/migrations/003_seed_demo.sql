-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- SITEFLOW DATABASE SEEDS - DEMO DATA
-- Migration: 003_seed_demo.sql
-- Contents: Demo tenant, users, project, tasks with blocks demonstration
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 1) DEMO TENANT
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO tenants (id, name, slug) VALUES
  ('11111111-1111-1111-1111-111111111111', 'Demo Construction Ltd', 'demo-construction')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 2) DEMO USERS (Password: demo123 - Argon2id hashed)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

-- NOTE: Real password hashes will be generated by apps/db/seed/run.ts using Argon2id
-- Placeholder hash below (do NOT use in production)
INSERT INTO users (id, tenant_id, email, name, password_hash, is_active) VALUES
  ('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '11111111-1111-1111-1111-111111111111', 
   'gc@demo.local', 'John Smith (GC)', '$argon2id$v=19$m=65536,t=3,p=1$placeholder', true),
  
  ('bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb', '11111111-1111-1111-1111-111111111111',
   'sub@demo.local', 'Mike Johnson (SUB)', '$argon2id$v=19$m=65536,t=3,p=1$placeholder', true),
  
  ('cccccccc-cccc-cccc-cccc-cccccccccccc', '11111111-1111-1111-1111-111111111111',
   'inspector@demo.local', 'Sarah Williams (Inspector)', '$argon2id$v=19$m=65536,t=3,p=1$placeholder', true),
  
  ('dddddddd-dddd-dddd-dddd-dddddddddddd', '11111111-1111-1111-1111-111111111111',
   'investor@demo.local', 'David Brown (Investor)', '$argon2id$v=19$m=65536,t=3,p=1$placeholder', true)
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 3) DEMO PROJECT
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO projects (id, tenant_id, name, code, created_by, updated_by) VALUES
  ('22222222-2222-2222-2222-222222222222', '11111111-1111-1111-1111-111111111111',
   'Residential Building Alpha', 'RBA-2026', 
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- Project Members
INSERT INTO project_members (project_id, user_id, role) VALUES
  ('22222222-2222-2222-2222-222222222222', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'GC'),
  ('22222222-2222-2222-2222-222222222222', 'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb', 'SUB'),
  ('22222222-2222-2222-2222-222222222222', 'cccccccc-cccc-cccc-cccc-cccccccccccc', 'INSPECTOR'),
  ('22222222-2222-2222-2222-222222222222', 'dddddddd-dddd-dddd-dddd-dddddddddddd', 'INVESTOR')
ON CONFLICT DO NOTHING;

-- Locations
INSERT INTO locations (id, project_id, parent_id, name, path, created_by, updated_by) VALUES
  ('loc-building', '22222222-2222-2222-2222-222222222222', NULL, 'Building A', '/Building A', 
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'),
  
  ('loc-floor-1', '22222222-2222-2222-2222-222222222222', 'loc-building', 'Floor 1', '/Building A/Floor 1',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'),
  
  ('loc-apt-101', '22222222-2222-2222-2222-222222222222', 'loc-floor-1', 'Apartment 101', '/Building A/Floor 1/Apartment 101',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 4) DEMO TASKS (Demonstrating Blocking System)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

-- Task 1: Foundation Work (DONE - no blocks)
INSERT INTO tasks (id, project_id, location_id, title, description, status, planned_date, created_by, updated_by) VALUES
  ('task-foundation', '22222222-2222-2222-2222-222222222222', 'loc-building',
   'Foundation Excavation and Pour', 'Complete foundation work', 'DONE', '2026-01-20',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO task_assignees (task_id, user_id) VALUES
  ('task-foundation', 'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb')
ON CONFLICT DO NOTHING;

-- Task 2: Framing (IN_PROGRESS - no blocks)
INSERT INTO tasks (id, project_id, location_id, title, description, status, planned_date, created_by, updated_by) VALUES
  ('task-framing', '22222222-2222-2222-2222-222222222222', 'loc-floor-1',
   'Floor 1 Framing', 'Install floor 1 structural framing', 'IN_PROGRESS', '2026-01-27',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO task_assignees (task_id, user_id) VALUES
  ('task-framing', 'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb')
ON CONFLICT DO NOTHING;

-- Task 3: Electrical Rough-in (PLANNED - BLOCKED by Delivery)
INSERT INTO tasks (id, project_id, location_id, title, description, status, planned_date, requires_inspection, created_by, updated_by) VALUES
  ('task-electrical', '22222222-2222-2222-2222-222222222222', 'loc-apt-101',
   'Electrical Rough-in', 'Install electrical wiring and boxes', 'PLANNED', '2026-02-03', true,
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO task_assignees (task_id, user_id) VALUES
  ('task-electrical', 'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb')
ON CONFLICT DO NOTHING;

-- Task 4: Plumbing Rough-in (PLANNED - BLOCKED by Decision)
INSERT INTO tasks (id, project_id, location_id, title, description, status, planned_date, created_by, updated_by) VALUES
  ('task-plumbing', '22222222-2222-2222-2222-222222222222', 'loc-apt-101',
   'Plumbing Rough-in', 'Install plumbing pipes and fixtures', 'PLANNED', '2026-02-05',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO task_assignees (task_id, user_id) VALUES
  ('task-plumbing', 'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb')
ON CONFLICT DO NOTHING;

-- Task 5: Drywall (NEW - BLOCKED by Dependency on Task 3 and 4)
INSERT INTO tasks (id, project_id, location_id, title, description, status, created_by, updated_by) VALUES
  ('task-drywall', '22222222-2222-2222-2222-222222222222', 'loc-apt-101',
   'Drywall Installation', 'Install and finish drywall', 'NEW',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- Task Dependencies (INV-10)
INSERT INTO task_dependencies (blocked_task_id, blocker_task_id, created_by) VALUES
  ('task-drywall', 'task-electrical', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'),
  ('task-drywall', 'task-plumbing', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 5) DEMO DELIVERY (Blocking Task 3)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO deliveries (id, project_id, task_id, supplier_name, status, blocks_work, expected_date, created_by, updated_by) VALUES
  ('delivery-electrical', '22222222-2222-2222-2222-222222222222', 'task-electrical',
   'ABC Electrical Supply', 'ORDERED', true, '2026-02-01',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO delivery_items (delivery_id, item_name, quantity_ordered, unit) VALUES
  ('delivery-electrical', 'Romex 12/2 Wire', 500, 'ft'),
  ('delivery-electrical', 'Electrical Boxes', 20, 'pcs'),
  ('delivery-electrical', 'Circuit Breakers', 10, 'pcs')
ON CONFLICT DO NOTHING;

-- Task Block for Delivery (INV-8)
INSERT INTO task_blocks (task_id, block_type, scope, ref_entity_type, ref_entity_id, message, created_by) VALUES
  ('task-electrical', 'DELIVERY', 'START', 'DELIVERY', 'delivery-electrical',
   'Waiting for electrical materials delivery (expected Feb 1)',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 6) DEMO DECISION (Blocking Task 4)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO decisions (id, project_id, related_type, related_id, subject, problem, status, blocks_work, 
                      decision_owner_id, due_date, created_by, updated_by) VALUES
  ('decision-plumbing', '22222222-2222-2222-2222-222222222222', 'TASK', 'task-plumbing',
   'Plumbing Layout Approval', 'Owner requests review of plumbing layout for apartment 101',
   'PENDING_APPROVAL', true, 'dddddddd-dddd-dddd-dddd-dddddddddddd', '2026-02-02',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

INSERT INTO decision_options (decision_id, option_text, cost_impact, time_impact_days) VALUES
  ('decision-plumbing', 'Option A: Standard layout as designed', 0, 0),
  ('decision-plumbing', 'Option B: Move master bath fixtures', 1500, 3)
ON CONFLICT DO NOTHING;

INSERT INTO decision_approvals (decision_id, approver_id, approved) VALUES
  ('decision-plumbing', 'dddddddd-dddd-dddd-dddd-dddddddddddd', NULL)
ON CONFLICT DO NOTHING;

-- Task Block for Decision (INV-9)
INSERT INTO task_blocks (task_id, block_type, scope, ref_entity_type, ref_entity_id, message, created_by) VALUES
  ('task-plumbing', 'DECISION', 'START', 'DECISION', 'decision-plumbing',
   'Waiting for plumbing layout decision approval',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 7) TASK BLOCKS for Dependencies (INV-10)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO task_blocks (task_id, block_type, scope, ref_entity_type, ref_entity_id, message, created_by) VALUES
  ('task-drywall', 'DEPENDENCY', 'START', 'TASK', 'task-electrical',
   'Blocked by: Electrical Rough-in (not completed)',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'),
  
  ('task-drywall', 'DEPENDENCY', 'START', 'TASK', 'task-plumbing',
   'Blocked by: Plumbing Rough-in (not completed)',
   'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- 8) DEMO TAGS
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

INSERT INTO tags (id, tenant_id, name, color) VALUES
  ('tag-critical', '11111111-1111-1111-1111-111111111111', 'Critical Path', '#ef4444'),
  ('tag-mep', '11111111-1111-1111-1111-111111111111', 'MEP Work', '#3b82f6'),
  ('tag-safety', '11111111-1111-1111-1111-111111111111', 'Safety Review', '#f59e0b')
ON CONFLICT DO NOTHING;

INSERT INTO task_tags (task_id, tag_id) VALUES
  ('task-foundation', 'tag-critical'),
  ('task-framing', 'tag-critical'),
  ('task-electrical', 'tag-mep'),
  ('task-plumbing', 'tag-mep')
ON CONFLICT DO NOTHING;

-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-- END OF DEMO SEEDS
-- 
-- Summary of Blocks Demonstrated:
-- 1. task-electrical: BLOCKED by delivery-electrical (INV-8: blocks_work=true)
-- 2. task-plumbing: BLOCKED by decision-plumbing (INV-9: PENDING_APPROVAL + blocks_work)
-- 3. task-drywall: BLOCKED by task-electrical AND task-plumbing (INV-10: dependencies)
-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
